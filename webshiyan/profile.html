<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>修改资料 - 微社区</title>
</head>
<body style="background:#f4f4f7; font-family:sans-serif; margin:0; padding:20px;">
    <div style="max-width:500px; margin:50px auto; background:white; padding:30px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
        <a href="index.html" style="text-decoration: none;color: #007bff;font-weight: bold;">&larr; 返回首页</a>
        <h2 style="border-bottom:2px solid #f4f4f7; padding-bottom:10px;">修改个人资料</h2>
        
        <div style="text-align:center; margin:20px 0;">
            <img id="avatar_preview" src="" style="width: 80px;height: 80px;border-radius: 50%;object-fit: cover;border: 2px solid #007bff;">
            <br>
            <input type="file" onchange="previewAvatar(event)" style="margin-top:10px;">
        </div>

        <label style="display:block; margin-bottom:5px; color:#666;">昵称</label>
        <input type="text" id="nick" style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ddd; border-radius:4px; box-sizing:border-box;">
        
        <label style="display:block; margin-bottom:5px; color:#666;">新密码 (不改请留空)</label>
        <input type="password" id="pwd" placeholder="请输入新密码" style="width:100%; padding:10px; margin-bottom:25px; border:1px solid #ddd; border-radius:4px; box-sizing:border-box;">
        
        <button onclick="updateProfile()" style="width:100%; padding:12px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; font-size:16px;">保存修改</button>
    </div>

    <script src="client.js"></script>
    <script>
        const u = getLocalUser();
        if(!u) location.href='login.html';
        
        // 初始填充数据
        document.getElementById('nick').value = u.nickname;
        document.getElementById('avatar_preview').src = u.avatar;

        function previewAvatar(e) {
            const reader = new FileReader();
            reader.onload = () => document.getElementById('avatar_preview').src = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        }
    </script>
</body>
</html>