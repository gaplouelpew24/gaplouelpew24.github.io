<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>从零开始建立后室营地</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap');

    :root {
        --white: 255, 255, 255;
        --black: 0, 0, 0;

        --red: 230, 23, 68;
        --orange: 239, 154, 45;

        --expbar-color: var(--orange);
        --link-color: var(--red);

        --light-yellow: 237, 233, 223;
        --light-grey: 196, 192, 182;

        --dark-brown: 72, 69, 60;

        --font: Noto Sans SC, Arimo, Verdana, Geneva, sans-serif;

        --expbar-startpoint: 0%;
    }

    body {
        display: flex;
        justify-content: space-between;
        background-color: rgb(var(--light-yellow));
        margin: 0;
        position: fixed;
        height: 100%;
        width: 100%;
        font-family: var(--font);
        color: rgb(var(--black));
    }

    a {color: rgb(var(--link-color));}
    a#CloseLeftBar {
        position: fixed;
        width: 100%;
        height: 100%;
        z-index: 1;
        background-color: rgba(var(--light-grey),.2);
        backdrop-filter: blur(.1rem);
    }

    button {font-family: var(--font);}
    button:hover, a:hover {cursor: pointer;}

    body:before {
        content: "";
        mask-image: url(data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22windows-1252%22%20standalone%3D%22no%22%3F%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xml%3Aspace%3D%22preserve%22%20width%3D%22106.667%22%20height%3D%22154.667%22%3E%3Cpath%20d%3D%22M72.547%201158.57H5.074V-6.465h67.473V1158.57M119.027%20710.25v-58.977l126.95%20154.438L363.43%20654.77v61.476L246.477%20865.688%20119.027%20710.25%22%20style%3D%22fill%3A%23333%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%20transform%3D%22matrix%28.13305%200%200%20-.13255%20-.633%20153.92%29%22%2F%3E%3Cpath%20d%3D%22M119.027%20951.652V790.715l125.45%20153.441L363.43%20792.715v166.933L247.477%201108.09l-128.45-156.438M763.27%201158.57h-63.473l63.473-80.97ZM472.387%201158.57h-67.473V-6.465h67.473V1158.57M518.867%20995.133v-58.977L645.816%201090.6%20763.27%20939.656v61.474l-116.954%20149.44-127.449-155.437M763.27%20657.27%20647.316%20805.711%20518.867%20649.273V488.336l125.449%20153.441L763.27%20490.336V657.27M518.867%201158.57v-82.97l67.973%2082.97z%22%20style%3D%22fill%3A%23333%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%20transform%3D%22matrix%28.13305%200%200%20-.13255%20-.633%20153.92%29%22%2F%3E%3Cpath%20d%3D%22M763.27%20413.867%20646.316%20563.309%20518.867%20407.867v-58.972l126.949%20154.437L763.27%20352.391v61.476M363.43%20128.98%20246.477%20278.422l-127.45-155.438V64.008l126.95%20154.437L363.43%2067.504v61.476%22%20style%3D%22fill%3A%23333%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%20transform%3D%22matrix%28.13305%200%200%20-.13255%20-.633%20153.92%29%22%2F%3E%3Cpath%20d%3D%22M363.43%20205.449v166.934L247.477%20520.824l-128.45-156.437V203.449l125.45%20153.442L363.43%20205.449M518.867%2071.504V-6.465h67.973l57.476%2070.473%2055.481-70.473h63.473V79.5L647.316%20227.941%20518.867%2071.504%22%20style%3D%22fill%3A%23333%3Bfill-opacity%3A1%3Bfill-rule%3Anonzero%3Bstroke%3Anone%22%20transform%3D%22matrix%28.13305%200%200%20-.13255%20-.633%20153.92%29%22%2F%3E%3C%2Fsvg%3E);
        mask-size: 3rem;
        mask-position: center;
        position: fixed;
        width: 100%;
        height: 100%;
        background-image: linear-gradient( to bottom, rgba(var(--dark-brown), .05) 0,rgba(var(--dark-brown), 0) 33%);
        z-index: -1;
    }

    #BaseValue {
        display: flex;
        flex-direction: column;
    }

    #LeftBar {
        width: 10rem;
        max-height: 100%;
        overflow: auto;
        background-image: linear-gradient(rgb(var(--light-grey)) 0,
                                    rgb(var(--light-grey)) 69px,
                                    rgba(0, 0, 0, 0) 69px,
                                    rgba(0, 0, 0, 0) 100%);
        transition: all .5s;
    }

    #LeftBar>img:first-child {
        width: 90%;
        margin: .5rem auto 1rem;
        filter: contrast(0.5);
    }

    #RightPart {flex: 1;}
    #LeftBar, #RightPart {
        display: flex;
        flex-direction: column;
        filter: drop-shadow(0px 1px 2px rgba(var(--dark-brown),0.5));
    }

    #TopBar {
        color: rgb(var(--light-yellow));
        background-color: rgb(var(--dark-brown));
        min-height: 70px;
        max-height: 70px;
        display: flex;
        align-items: center;
        padding: 0 1rem;
        font-weight: bold;
        font-size: 1.1rem;
        gap: 1rem;
        justify-content: space-between;
    }

    #TopBar .sidebar {display: none;}
    #TopBar .sidebar a {
        text-decoration: none;
        color: rgb(var(--light-yellow));
        font-size: 2.5em;
    }

    #MainContent {
        height: 100%;
        max-height: 100%;
        overflow: auto;
        padding: 1rem;
    }

    #ExpLevel {
        display: flex;
        align-items: center;
    }

    #ExpLevel .ExpBar {
        width: 20vw;
        height: .5rem;
        background-image: linear-gradient(to right,rgb(var(--expbar-color)) var(--expbar-startpoint),rgb(var(--light-yellow)) var(--expbar-startpoint),rgb(var(--light-yellow))) ;
        border-radius: 5px;
        margin: 2px 1rem 0;
    }

    #LeftBar>button {
        border: none;
        background-color: rgba(var(--light-grey),0.2);
        padding: .5rem;
        color: rgb(var(--light-yellow));
        font-size: 1rem;
        font-weight: bold;
        font-family: var(--font);
        transition: background-color .1s;
    }

    #LeftBar>button:hover, #LeftBar>button.select {background: rgba(var(--light-grey),0.5);}
    #LeftBar>button.select {cursor: default;}
    #LeftBar>button.initialization {
        background-color: rgba(var(--red));
        transition: filter .5s;
    }
    #LeftBar>button.initialization:hover {filter: brightness(1.5);}

    #MainContent .buttons {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
    }

    #MainContent .buttons>button {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: .5rem 1rem;
        padding: .5rem 1rem;
        background-color: rgb(var(--dark-brown));
        border: 0;
        border-top: 5px solid rgb(var(--light-grey));
        color: rgb(var(--light-yellow));
        font-weight: bold;
        transition:filter .5s, margin .5s;
    }

    #MainContent .buttons>button:hover {
        filter: brightness(1.3) drop-shadow(0 0 15px rgb(var(--light-grey)));
        margin: .25rem 1rem .75rem;
    }

    #MainContent .buttons>button>.action {font-size: 1rem;}
    #MainContent .buttons>button>.name {font-size: 1.5rem;}
    #MainContent .buttons>button:hover>.bar {background-color: rgb(var(--red));}
    #MainContent .buttons>button>.bar {
        height: 1rem;
        width: 8rem;
        background-color: rgb(var(--light-yellow));
        border-radius: .7rem;
        filter: drop-shadow(0 0 2px rgba(0,0,0,.2));
        transition:background-color .25s;
    }


    @media (max-width: 700px) {
        #TopBar {font-size: 1rem;}
        #TopBar .sidebar {display: block;}
        #TopBar #BaseValue, #TopBar .column {flex: 3;}
        #ExpLevel .ExpBar {display: none;}
        #PlExp {margin-left: .5rem;}
        #PlExp::before {content:"(";}
        #PlMaxExp::after {content:")";}

        #LeftBar {
            left: -10rem;
            position: fixed;
            z-index: 3;
            background-color: rgba(var(--light-yellow),.1);
            height: 100%;
            backdrop-filter: blur(3rem);
            background-image: linear-gradient(rgb(var(--light-grey)) 0,
                                    rgb(var(--light-grey)) 70px,
                                    rgba(0, 0, 0, 0) 70px,
                                    rgba(0, 0, 0, 0) 100%);
        }
    }

    @media (min-width: 701px) {
        #LeftBar {left: 0!important;}
    }

    </style>
</head>
<body>
    <a id="CloseLeftBar" onclick="click_event('toggleleftbar', this)" style="display: none;"></a>
    <div id="LeftBar" style="left: -10rem;">
        <img src="https://7bye.com/hoah/i/2023/12/31/5hsx3.svg">
            <button id="LeftBase">营地</button>
            <br>
            <button id="LeftSearch" class="select">搜刮</button>
            <button id="LeftExplorer">探险</button>
            <br>
            <button class="initialization" onclick="click_event('initialization', this)" onmouseout="mouse_event('initialization', this)">初始化</button>
    </div>

    <div id="RightPart">
        <div id="TopBar">
            <div class="sidebar">
                <a onclick="click_event('toggleleftbar', this)">≡</a>
            </div>
            <div id="BaseValue">
                <span>杏仁水：<span id="AlmondWater">0</span> 毫升</span>
                <span>流浪者：<span id="Wanderers">0</span> 人</span>
            </div>
            <div class="column">
                <div id="BaseSpeed">
                    <span>当前速度：<span id="Speed">0</span> 毫升 / 每秒</span>
                </div>
                <div id="ExpLevel">
                    <span>当前等级：<span id="PlLevel">0</span></span>
                    <div class="ExpBar"></div>
                    <span><span id="PlExp">0</span> / <span id="PlMaxExp">0</span></span>
                </div>
            </div>    
        </div>

        <div id="MainContent">
            <div id="CSearch">
                <div class="buttons">
                    <button onclick="click_event('search', this), click_event('changebarcolor', this)" class="click level1">
                        <span class="action">搜寻</span>
                        <span class="name">杏仁水</span>
                        <br>
                        <div class="bar"></div>
                        <br>
                        <span class="level">搜寻等级：<span id="AmSearchLv"></span></span>
                    </button>
                </div>
            </div>
            <div id="CExplorer">
            </div>
            <div id="CBase">
            </div>


        </div>
    </div>

    
    <script>
        console.log('从零开始建立后室基地\n作者：GaplouelPew\n游戏版本：v0.0.1');

        //基础变量声明
        let base, level, speed, exp;
        //布尔变量声明
        let initializationClicked = false;

        //读取本地数据并加载
        const storedBase = localStorage.getItem('base');
        const storedLevel = localStorage.getItem('level');
        const storedSpeed = localStorage.getItem('speed');
        const storedExp = localStorage.getItem('exp');

        if (!storedBase) initialization();
        else {
            base = JSON.parse(localStorage.getItem('base'));
            level = JSON.parse(localStorage.getItem('level'));
            speed = JSON.parse(localStorage.getItem('speed'));
            exp = JSON.parse(localStorage.getItem('exp'));
        }

        const expBar = document.querySelector('#ExpLevel .ExpBar');

        setInterval(update, 0);
        setInterval(get_almondwater, 10)

        //点击事件
        function click_event(name, button){
            if (name == "search"){
                base.almondWater += 1 + Math.pow((level.searchLevel.almondWater - 1) / 10, 2);
            }

            //点击后修改bar的颜色
            if (name == "changebarcolor") {
                const bar = button.querySelector('.bar');
                if (bar) {
                    bar.style.backgroundColor = "rgba(var(--red),.5)";

                    //恢复原色
                    setTimeout(() => {
                    bar.style.backgroundColor = '';
                    }, 100);
                }
            }

            //侧栏开关
            if (name == "toggleleftbar") {
                const leftBar = document.getElementById('LeftBar');
                const closeBar = document.getElementById('CloseLeftBar');
                if (leftBar.style.left == '-10rem') {
                    leftBar.style.left = '0';
                    closeBar.style.display = 'unset';
                } 
                else {
                    leftBar.style.left = '-10rem';
                    closeBar.style.display = 'none';
                }
            }

            //初始化
            if (name == "initialization") {
                if (!initializationClicked) {
                    button.textContent = '确定？';
                    initializationClicked = true;
                }
                else {
                    initialization();
                    button.textContent = '初始化';
                    initializationClicked = false;
                }
            }
        };

        //鼠标移入移出事件
        function mouse_event(name, button){
            if (name == "initialization") {
                button.textContent = '初始化';
                initializationClicked = false;
            }
        }
        
        //更新
        function update(){
            display_values();
            level_and_speed();
            local_storage();

            base.speed = speed.wandererSpeed;

            exp.maxExp = Math.pow(exp.currentLevel, 2) * 5;
            expBar.style.setProperty('--expbar-startpoint', (exp.currentExp / exp.maxExp) * 100 + '%');
        };

        //更新数值显示
        function display_values(){
            document.getElementById('AlmondWater').textContent = base.almondWater.toFixed(2);
            document.getElementById('Wanderers').textContent = base.wanderer;
            document.getElementById('Speed').textContent = base.speed;

            document.getElementById('PlLevel').textContent = exp.currentLevel;
            document.getElementById('PlExp').textContent = exp.currentExp;
            document.getElementById('PlMaxExp').textContent = exp.maxExp;

            document.getElementById('AmSearchLv').textContent = level.searchLevel.almondWater;
        }

        //保存本地数据
        function local_storage(){
            localStorage.setItem('base', JSON.stringify(base));
            localStorage.setItem('level', JSON.stringify(level));
            localStorage.setItem('speed', JSON.stringify(speed));
            localStorage.setItem('exp', JSON.stringify(exp));
        }

        //获取杏仁水的速度
        function get_almondwater(){base.almondWater += base.speed / 100;}

        //等级与速度
        function level_and_speed(){
            speed.wandererSpeed = base.wanderer *(1 + ((level.increaseLevel.wandererLevel - 1) / 10));
        }

        //初始化
        function initialization(){
            base = {
                almondWater: 0,
                wanderer: 0,
                speed: 0,
            };

            level = {
                searchLevel: {
                    almondWater: 1,
                },
                increaseLevel: {
                    wandererLevel: 1,
                },
                
            };

            speed = {
                wandererSpeed: 0,
            };

            exp = {
                currentLevel: 1,
                currentExp: 0,
                maxExp: 0,
            };
        }

        //分页
        const buttons = document.querySelectorAll('button[id^="Left"]');
        const divs = document.querySelectorAll('div[id^="C"]');

        buttons.forEach(button => {
            button.addEventListener('click', function() {
                buttons.forEach(btn => {
                    btn.classList.remove('select');
                });
                this.classList.add('select');

                divs.forEach(div => {
                    if (div.id.startsWith('C')) {
                            div.style.display = 'none';
                        }
                    });

                const targetDivId = this.id.replace('Left', 'C');
                const targetDiv = document.getElementById(targetDivId);
                if (targetDiv) {
                    targetDiv.style.display = 'unset';
                }
            });
        });
    </script>
</body>
</html>